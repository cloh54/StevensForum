<main>
    <div class="modal" id="report-modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close" id="close-report">&times;</span>
                <h2>Report this post</h2>
            </div>
            <div class="modal-form">
                <div class="form-container">
                    <form id="report-form" action="/posts/{{post._id}}/createReport" method="post">
                        <label for="report">Why are you reporting this post?</label>
                        <input type="text" name="report">
                        <input type="submit" value="Submit">
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div class="modal" id="edit-post-modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close" id="close-edit-post">&times;</span>
                <h2>Edit this post</h2>
            </div>
            <div class="model-form">
                <div class="form-container">
                    <form id="edit-post-form" action="/posts/{{post._id}}/edit" method="post">
                        <label for="topic">Topic</label>
                        <input type="text" id="topic" name="topic">

                        <label for="body">What is your question?</label>
                        <input type="text" id="body" name="body">

                        <label for="tags">Tags</label>
                        <p>Please add a comma separated list of tags to help describe your post.</p>
                        <p>Tags should be lower-case</p>
                        <input type="text" id="tags" name="tags">

                        <input type="submit" value="Submit">
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div class="modal" id="delete-post-modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close" id="close-delete-post">&times;</span>
                <h2>Delete this post</h2>
            </div>
            <div class="model-form">
                <div class="form-container">
                    <form id="delete-post-form" action="/posts/{{post._id}}/delete" method="post">
                        <label for="topic">Are you sure you want to delete this post? All comments made under this post will also be deleted.</label>
                        <input type="checkbox" id="delete" name="delete" value="delete">
                        <div class="delete-submit">
                            <input type="submit" value="Submit">
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div class="post-container">
        <div class="button-container">
            {{#if user}}
            {{#if (eqid user.id post.userId)}}
            <div class="edit-delete-post-button-container">
                <button class="edit-button" id="edit-post-button">Edit</button>
                <button class="delete" id="delete-post-button">Delete</button>
            </div>
            {{/if}}
            <div class="report-button-container">
                <button class="report-button" id="report-button">Report</button>
            </div>
            {{/if}}
        </div>
        <h1>{{post.topic}}</h1>
        <h2>{{post.userName}}</h2>
        <p>{{post.body}}</p>
        <div class="tag-container">
            <h4>Tags</h4>
            {{#each post.tags}}
            <p class="tag">{{this}}</p>
            {{/each}}
        </div>
        <div class="like-container">
            <button id="like" class="like-button">Like</button>
            <button id="dislike" class="like-button">Dislike</button>
        </div>
    </div>
    {{#if user}}
    <div class="form-container" id="comment-form-container">
        <form id="comment-form" action="/posts/{{post._id}}/comment" method="post">
            <label for="comment">What is your answer?</label>
            <input type="text" name="comment">
            <input type="submit" value="Comment">
        </form>
    </div>
    {{/if}}
    <div class="comments-container">
        <h3>Comments</h3>
        <ul>
            {{#each commentsList}}
            <div class="comment-container">
                <p><strong>{{userName}}</strong></p>
                <p>{{body}}</p>
            </div>
            {{/each}}
            
        </ul>
    </div>
</main>

<script>
let post = {{{post}};

$('#like').click(function() {
$.ajax({
  url: '/posts/addLike/' + post._id,
  method: 'POST',
  success: function(data) {
    $('#like').text(data.likeCount);
  }
});
$(this).addClass('clicked').prop('disabled', true);
$('#dislike').removeClass('clicked').prop('disabled', false);
});

$('#dislike').click(function() {
$.ajax({
  url: '/posts/addDislike/' + post._id,
  method: 'POST',
  success: function(data) {
    $('#dislike').text(data.likeCount);
  }
});
$(this).addClass('clicked').prop('disabled', true);
$('#like').removeClass('clicked').prop('disabled', false);
});

</script>